<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <title>× ×¡×¤×— ×' - ×©× ×ª 2026</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 20px; background-color: #eee; font-size: 10px; }
        .page-container {
            width: 210mm;
            min-height: 297mm;
            background: white;
            margin: auto;
            padding: 8mm;
            box-sizing: border-box;
            border: 1px solid #ccc;
        }
        
        .header-top { text-align: center; margin-bottom: 5px; }
        .header-top h2 { margin: 0; font-size: 14px; text-decoration: underline; font-weight: bold; }
        .header-right { float: right; font-weight: bold; font-size: 12px; }
        .balmas { text-align: center; font-weight: bold; margin-bottom: 5px; }
        .sub-header { text-align: center; font-size: 9px; margin-bottom: 5px; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 5px; }
        th, td { border: 1px solid #000; padding: 2px; text-align: center; vertical-align: middle; }
        
        th, .group-header { background-color: #f0f0f0; font-weight: bold !important; font-size: 9px; height: 20px; }
        .label-cell { font-weight: bold; background-color: #f9f9f9; font-size: 9px; }
        
        .auto-width { width: auto; white-space: nowrap; min-width: 90px; }
        
        input, select { width: 100%; border: none; background: transparent; text-align: center; font-family: inherit; font-size: 10px; outline: none; appearance: none; -webkit-appearance: none; }
        
        .km-input { 
            font-weight: bold; 
            font-size: 11px; 
            min-width: 40px;
            padding-right: 2px;
            padding-left: 2px;
        }

        .footer-container { display: flex; border: 1px solid #000; margin-top: 5px; min-height: 200px; page-break-inside: avoid; }
        .footer-section { flex: 1; padding: 5px; border-left: 1px solid #000; font-size: 8.5px; text-align: right; line-height: 1.4; }
        .footer-section:last-child { border-left: none; }
        .footer-section h4 { text-decoration: underline; margin: 0 0 5px 0; font-size: 10px; text-align: center; font-weight: bold; }
        
        .checkbox-line { margin-bottom: 3px; display: flex; align-items: center; font-weight: bold; }
        .checkbox-line input[type="checkbox"] { width: 13px; height: 13px; margin-left: 5px; appearance: checkbox; -webkit-appearance: checkbox; cursor: pointer; }

        .sig-container { position: relative; border-bottom: 1px solid #000; background: #fdfdfd; }
        canvas { cursor: crosshair; }
        .clear-btn { background: #ff4d4d; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 7px; padding: 1px 4px; margin-right: 4px; }
        
        .reset-btn { background: #dc3545; color: white; border: none; border-radius: 4px; padding: 10px 20px; font-weight: bold; cursor: pointer; margin-right: 10px; }

        @media print {
            body { background: white; padding: 0; }
            .page-container { border: none; width: 100%; margin: 0; }
            .no-print, .clear-btn, .reset-btn { display: none; }
            input[type="date"]::-webkit-calendar-picker-indicator { display: none; -webkit-appearance: none; }
            select { appearance: none; -webkit-appearance: none; border: none; background: transparent; }
            .auto-width { width: auto !important; }
            .km-input { border: none; width: 100%; text-align: center; }
        }
    </style>
</head>
<body>

<div class="page-container">
    <div class="header-right">24-72</div>
    <div class="balmas">- ×‘×œ×"×¡ -</div>
    <div class="header-top">
        <h2>×ª×©×œ×•× ×ª×•×¡×¤×ª ××©"×œ ×•×§×¦×•×‘×ª ×›×œ×›×œ×”</h2>
        <div class="sub-header">× ×•×¡×— ××¢×•×“×›×Ÿ ×œ×ª××¨×™×š: 01/01/2026</div>
        <h1 style="font-size: 14px; margin: 2px 0; font-weight: bold; text-align: center;">× ×¡×¤×— ×'</h1>
        <div style="font-weight: bold; font-size: 11px; text-align: center; margin-bottom: 10px;">×—×©×‘×•×Ÿ ×”×•×¦××•×ª ××™×©×™×•×ª ×‘×ª×¤×§×™×“ - ××–×¨×—×™× ×¢×•×‘×“×™ ×¦×”"×œ</div>
    </div>

    <table>
        <tr>
            <td style="width: 15%;" class="label-cell">×¢×‘×•×¨ ×—×•×“×© / ×©× ×”<br>
                <div style="display: flex; justify-content: center;">
                    <select id="reportMonth" class="save-me" style="width: 50%; font-weight: bold;" onchange="syncDatesWithMonth()">
                        <option value="01">01</option><option value="02">02</option><option value="03">03</option>
                        <option value="04">04</option><option value="05">05</option><option value="06">06</option>
                        <option value="07">07</option><option value="08">08</option><option value="09">09</option>
                        <option value="10">10</option><option value="11">11</option><option value="12" selected>12</option>
                    </select>
                    <span> / </span>
                    <input type="text" id="reportYear" class="save-me" value="2026" style="width: 40%; font-weight: bold;" onchange="syncDatesWithMonth()">
                </div>
            </td>
            <td style="width: 25%;" class="label-cell">××¡×¤×¨ ×–×”×•×ª<br><input type="text" id="workerID" class="save-me"></td>
            <td style="width: 20%;" class="label-cell">×©× ××©×¤×—×”<br><input type="text" id="lastName" class="save-me"></td>
            <td style="width: 20%;" class="label-cell">×©× ×¤×¨×˜×™<br><input type="text" id="firstName" class="save-me"></td>
            <td style="width: 20%;" class="label-cell">×ª×¤×§×™×“ ×”×¢×•×‘×“<br><input type="text" value="×‘×•×—×Ÿ × ×”×™×’×”" readonly style="font-weight: bold;"></td>
        </tr>
    </table>

    <table style="margin-top: -6px;">
        <tr>
            <td style="width: 40%;" class="label-cell">×›×ª×•×‘×ª ××’×•×¨×™×<br><input type="text" id="address" class="save-me"></td>
            <td style="width: 15%;" class="label-cell">×™×—×•×™×™×©<br><input type="text" id="yihuish" class="save-me"></td>
            <td style="width: 15%;" class="label-cell">×™×—×™×“×”<br><input type="text" value='××§×œ"×¨ 48' readonly style="font-weight: bold;"></td>
            <td style="width: 15%;" class="label-cell">×©×¢×•×ª ×¢×‘×•×“×” ×¨×’×™×œ×•×ª ×©×œ ×”×¢×•×‘×“<br>
                <div style="display: flex; font-size: 8px;">×™××™ ×'-×”' ×-<input type="text" style="width:25px" value="08:00"> ×¢×“-<input type="text" style="width:25px" value="16:30"></div>
            </td>
            <td style="width: 15%;" class="label-cell">××˜×¨×ª ×”× ×¡×™×¢×”<br><input type="text" value="×ª×¤×§×™×“" readonly style="font-weight: bold;"></td>
        </tr>
    </table>

    <table>
        <thead>
            <tr>
                <th rowspan="3" style="width: 25px;">××¡' ×¡×“×™×¨</th>
                <th colspan="7" class="group-header">×¤×¨×˜×™ ×”× ×¡×™×¢×” ×‘×ª×¤×§×™×“</th>
                <th colspan="5" class="group-header">×”×•×¦××•×ª</th>
            </tr>
            <tr>
                <th rowspan="2" class="auto-width">×ª××¨×™×š</th>
                <th rowspan="2" style="width: 45px;">×©×¢×ª ×™×¦×™××”</th>
                <th rowspan="2" style="width: 60px;">×××§×•×</th>
                <th rowspan="2" class="auto-width">×œ××§×•× (×‘××™×“×” ×•× ×©×œ×— ×œ×™×—×™×“×” ×¦×‘××™×ª ×™×© ×œ×¦×™×™×Ÿ ×©× ×”×™×—×™×“×”)</th>
                <th rowspan="2" style="width: 60px;">×œ××§×•×</th>
                <th rowspan="2" style="width: 45px;">××¨×—×§ ×‘×§"×</th>
                <th rowspan="2" style="width: 45px;">×©×¢×ª ×¡×™×•×</th>
                <th rowspan="2" style="width: 40px;">×“××™ × ×¡×™×¢×” (××’')</th>
                <th colspan="3">×›×œ×›×œ×” (×¡×š ×©×¢×•×ª ×‘×ª×¤×§×™×“)</th>
                <th rowspan="2" style="width: 45px;">×“××™ ×œ×™× ×” ×‘××œ×•×Ÿ (××’')</th>
            </tr>
            <tr>
                <th style="width: 22px;">4</th>
                <th style="width: 22px;">8</th>
                <th style="width: 22px;">12</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <div class="footer-container">
        <div class="footer-section">
            <h4>×”×¦×”×¨×ª ×”×¢×•×‘×“/×ª</h4>
            <div class="checkbox-line"><input type="checkbox" class="save-me-check" id="decl1"> × ×¡×¢×ª×™ ×‘×¨×›×‘ ×¤×¨×˜×™</div>
            <div class="checkbox-line"><input type="checkbox" class="save-me-check" id="decl2"> × ×¡×¢×ª×™ ×‘×ª×—×‘×•×¨×” ×¦×™×‘×•×¨×™×ª</div>
            <div class="checkbox-line"><input type="checkbox" class="save-me-check" id="decl3"> × ×¡×¢×ª×™ ×‘×¨×›×‘ ×¦×‘××™ / ×©×›×•×¨</div>
            <p style="margin-top: 5px;">×”× × ×™ ××¦×”×™×¨/×” ×‘×–×” ×›×™ ×›×œ ×”×¤×¨×˜×™× ×©×¤×•×¨×˜×• ×‘×˜×•×¤×¡ ×–×” ×”× × ×›×•× ×™×, ×©×œ××™× ×•××“×•×™×§×™× ×•×‘×™××™× ×¢×‘×•×¨× ×”× × ×™ ××‘×§×©/×ª ×“××™ ×›×œ×›×œ×”, ×œ× ×”×ª×›×œ×›×œ×ª×™ ×‘×™×—×™×“×” ×›×œ×©×”×™.</p>
            
            <div style="margin-top: 10px;">×ª××¨×™×š: <input type="text" id="sigDate" class="save-me" style="width: 80px; text-align: right; border-bottom: 1px solid #000; font-weight:bold;"></div>
            
            <div style="display: flex; align-items: center; margin-top: 3px;">
                <span>×—×ª×™××ª ×”×¢×•×‘×“/×ª:</span>
                <div class="sig-container"><canvas id="workerSig" width="110" height="35"></canvas></div>
                <button class="clear-btn no-print" onclick="clearSig('workerSig')">× ×§×”</button>
            </div>
        </div>

        <div class="footer-section">
            <h4>××™×©×•×¨ ××¤×§×“ ×™×©×™×¨ ×”××—×¨××™ ×œ××™×œ×•×™ ×“×•"×— ×ª×¢×¡×•×§×”</h4>
            <div class="checkbox-line"><input type="checkbox" class="save-me-check" id="cmd1"> ×”×¢×•×‘×“/×ª × ×¡×¢ ×‘×¨×›×‘ ×¦×‘××™ / ×©×›×•×¨ ×›×™ <span style="border-bottom:1px solid #000; width:50px; display:inline-block;"><input type="text" class="save-me" id="cmdReason" style="width:100%"></span></div>
            <div class="checkbox-line"><input type="checkbox" class="save-me-check" id="cmd2"> ×”×¢×•×‘×“ ×œ× × ×¡×¢ ×‘×¨×›×‘ ×¦×‘××™ / ×©×›×•×¨</div>
            <p style="margin-top: 5px;">×”× × ×™ ××¦×”×™×¨ ×©×‘×“×§×ª×™ ××ª ×”×—×©×‘×•×Ÿ ×•×××©×¨ ×‘×–×” ××ª ×××™×ª×•×ª×Ÿ ×•××ª ×–×›×•×™×•×ª×™×• ×©×œ ×”××–×¨×— ×”× "×œ ×œ×”×•×¦××•×ª ×¢"×¤ ×¤.×. 41.0515</p>
            <div style="margin-top: 15px;">×ª××¨×™×š: __________ ×—×ª×™××”: __________</div>
            <div style="margin-top: 8px;">×©×: __________ ×“×¨×’×”: ______ ×.×.: ______</div>
        </div>

        <div class="footer-section">
            <h4>××™×©×•×¨ ×”××¤×§×“ ×”×××•× ×” ×‘×“×¨×’×ª ×¡×"×œ ××• ×©×”×™× ×• ××¢"×¦ ×‘×›×™×¨ ×‘×ª×§×Ÿ × ×’×‘ ×•××¢×œ×”</h4>
            <div style="font-weight: bold; text-align: center;">×”× × ×™ ×××©×¨ ×‘×–×” ××ª ×”×”×•×¦××•×ª ×”× "×œ.</div>
            <div style="margin-top: 5px;">×”×¢×¨×•×ª: _________________________________</div>
            <div style="margin-top: 35px;">×ª××¨×™×š: __________ ×—×ª×™××”: __________</div>
            <div style="margin-top: 8px;">×©×: __________ ×“×¨×’×”: ______ ×.×.: ______</div>
        </div>
    </div>
</div>

<div class="no-print" style="text-align:center; margin-top:20px; padding-bottom: 50px;">
    <button onclick="saveAndPrint()" style="padding:10px 25px; background:#28a745; color:white; border:none; cursor:pointer; border-radius:4px; font-weight:bold;">ğŸ–¨ï¸ ×”×“×¤×¡ ×•×©××•×¨ ×‘×©× ××•×˜×•××˜×™</button>
    <button onclick="resetForm()" class="reset-btn">ğŸ—‘ï¸ × ×§×” ×˜×•×¤×¡ ×œ×—×•×“×© ×—×“×©</button>
</div>

<script>
    const destinations = [
        { name: "××•×¤×§×™×", km: 115 }, { name: "××™×œ×ª", km: 350 }, { name: "××©×“×•×“", km: 41 }, { name: "××©×§×œ×•×Ÿ", km: 56 },
        { name: "×‘××¨ ×©×‘×¢", km: 113 }, { name: "×‘××¨ ×©×‘×¢ ×‘×™×ª ×”×—×™×™×œ", km: 113 }, { name: "×‘××¨ ×©×‘×¢ ×œ\"×’", km: 113 },
        { name: "×‘×—\"× 6 ×—×¦×™×¨×™×", km: 125 }, { name: "×‘×—\"× 8 ×ª×œ × ×•×£", km: 40 }, { name: "×‘×—\"× 21 ×˜×›× ×™", km: 110 },
        { name: "×‘×™×¡\"×˜ 21", km: 110 }, { name: "×‘×™×ª × ×‘××œ×œ×”", km: 27 }, { name: "×‘×™×ª ×©××©", km: 55 },
        { name: "×‘×”×œ\"×¦", km: 288 }, { name: "×“×™××•× ×”", km: 157 }, { name: "×”×“×¨ ×™×•×¡×£", km: 12 },
        { name: "×—×“×¨×”", km: 49 }, { name: "×—×•×œ×•×Ÿ", km: 10 }, { name: "×—×™×¤×”", km: 100 },
        { name: "×—×™×¤×” ×œ\"×’", km: 110 }, { name: "×˜×‘×¨×™×”", km: 135 }, { name: "×˜×‘×¨×™×” ×œ\"×’", km: 135 },
        { name: "×™×¤×•", km: 0 }, { name: "×™×¨×•×©×œ×™×", km: 65 }, { name: "×™×¨×•×©×œ×™× ×œ\"×’", km: 65 },
        { name: "×›× ×£ 1 ×¨××ª ×“×•×“", km: 92 }, { name: "×›× ×£ 25 ×¨××•×Ÿ", km: 195 }, { name: "×›× ×£ 28 × ×‘×˜×™×", km: 140 },
        { name: "×›×¤×¨ ×¡×‘×", km: 27 }, { name: "×œ×•×“", km: 27 }, { name: "××—× ×” ×¢××•×¡", km: 92 },
        { name: "××©××¨ ×”× ×’×‘", km: 113 }, { name: "× ×‘×˜×™×", km: 140 }, { name: "× ×ª×™×‘×•×ª", km: 100 },
        { name: "× ×ª× ×™×”", km: 32 }, { name: "×¢×™×¨ ×”×‘×”×“×™×", km: 135 }, { name: "×¢×›×•", km: 128 },
        { name: "×¢×¤×•×œ×”", km: 92 }, { name: "×¢×¤×•×œ×” ××©× ×›×‘×“", km: 92 }, { name: "×¤×œ××—×™×", km: 27 },
        { name: "×¤×ª×— ×ª×§×•×•×”", km: 17 }, { name: "×§×¨×™×ª ×’×ª", km: 71 }, { name: "×§×¨×™×ª ×—×™×™×", km: 118 },
        { name: "×§×¨×™×ª ×©××•× ×”", km: 191 }, { name: "×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ", km: 17 }, { name: "×¨×—×•×‘×•×ª", km: 21 },
        { name: "×¨××œ×”", km: 25 }, { name: "×ª×”\"×© ×œ\"×’", km: 18 }
    ].sort((a, b) => a.name.localeCompare(b.name, 'he'));

    // --- Logic for Dates (Sunday) & Auto Sync Last Row ---
    function handleDateChange(input) {
        const row = input.closest('tr');
        const col4 = row.querySelector('.col-4');
        const col8 = row.querySelector('.col-8');
        const dateVal = input.value;
// Sunday check
        if (dateVal) {
            // ×ª×™×§×•×Ÿ: ×¤×™×¨×•×§ ×”×ª××¨×™×š ×›×“×™ ×œ×× ×•×¢ ×‘×¢×™×•×ª ××–×•×¨×™ ×–××Ÿ ×‘××•×‘×™×™×œ
            const parts = dateVal.split('-'); 
            // ×™×¦×™×¨×ª ×ª××¨×™×š ×œ×¤×™ ×©× ×”, ×—×•×“×© (×¤×—×•×ª 1 ×›×™ ××ª×—×™×œ ×-0), ×•×™×•×
            const date = new Date(parts[0], parts[1] - 1, parts[2]);
            
            if (date.getDay() === 0) { // Sunday
                col4.value = "X"; 
                col8.value = ""; // No X in 8 on Sunday
            } else {
                col4.value = "X"; 
                col8.value = "X";
            }
        }
        // Sync date from Last Row (23) to Signature Date
        const allRows = document.querySelectorAll('#tableBody tr');
        const lastRowIndex = allRows.length - 1; // Row 23 (index 22)

        if (row === allRows[lastRowIndex] && dateVal) {
            const [y, m, d] = dateVal.split('-');
            document.getElementById('sigDate').value = `${d}/${m}/${y}`;
        } else if (row === allRows[lastRowIndex] && !dateVal) {
             document.getElementById('sigDate').value = "";
        }

        saveFormData(); // Save on date change
    }

    // --- Signature ---
    function setupSignature(id) {
        const canvas = document.getElementById(id);
        const ctx = canvas.getContext("2d");
        let drawing = false;
        
        const savedSig = localStorage.getItem('signature_' + id);
        if (savedSig) {
            const img = new Image();
            img.onload = () => ctx.drawImage(img, 0, 0);
            img.src = savedSig;
        }

        const getPos = (e) => {
            const rect = canvas.getBoundingClientRect();
            const clientX = (e.touches ? e.touches[0].clientX : e.clientX);
            const clientY = (e.touches ? e.touches[0].clientY : e.clientY);
            return { x: clientX - rect.left, y: clientY - rect.top };
        };
        const start = (e) => { drawing = true; ctx.beginPath(); const pos = getPos(e); ctx.moveTo(pos.x, pos.y); e.preventDefault(); };
        const move = (e) => { 
            if (!drawing) return; 
            const pos = getPos(e); 
            ctx.lineTo(pos.x, pos.y); 
            ctx.stroke(); 
            e.preventDefault(); 
        };
        const stop = () => { 
            if(drawing) {
                drawing = false; 
                localStorage.setItem('signature_' + id, canvas.toDataURL());
            }
        };
        canvas.addEventListener("mousedown", start); canvas.addEventListener("mousemove", move); window.addEventListener("mouseup", stop);
        canvas.addEventListener("touchstart", start); canvas.addEventListener("touchmove", move); canvas.addEventListener("touchend", stop);
        ctx.lineWidth = 1.5; ctx.strokeStyle = "#000";
    }

    function clearSig(id) { 
        document.getElementById(id).getContext("2d").clearRect(0, 0, 110, 35); 
        localStorage.removeItem('signature_' + id);
    }

    // --- Form Saving & Loading ---
    function saveFormData() {
        document.querySelectorAll('.save-me').forEach(input => localStorage.setItem(input.id, input.value));
        document.querySelectorAll('.save-me-check').forEach(input => localStorage.setItem(input.id, input.checked));
        
        const rowsData = [];
        document.querySelectorAll('#tableBody tr').forEach((row) => {
            const rowObj = {
                date: row.querySelector('.row-date').value,
                timeOut: row.querySelector('.time-out').value,
                placeOut: row.querySelector('.place-out').value,
                target: row.querySelector('.target-select').value,
                placeIn: row.querySelector('.place-in').value,
                km: row.querySelector('.km-input').value,
                timeIn: row.querySelector('.time-in').value,
                costBus: row.querySelector('.cost-bus').value,
                col4: row.querySelector('.col-4').value,
                col8: row.querySelector('.col-8').value,
                costHotel: row.querySelector('.cost-hotel').value
            };
            rowsData.push(rowObj);
        });
        localStorage.setItem('tableRows_23', JSON.stringify(rowsData)); 
    }
function loadFormData() {
        // ×˜×¢×™× ×ª ×©×“×•×ª ×›×œ×œ×™×™×
        document.querySelectorAll('.save-me').forEach(input => {
            if (localStorage.getItem(input.id)) input.value = localStorage.getItem(input.id);
        });
        // ×˜×¢×™× ×ª ×¦'×§×‘×•×§×¡×™×
        document.querySelectorAll('.save-me-check').forEach(input => {
            if (localStorage.getItem(input.id) === 'true') input.checked = true;
        });

        // ×˜×¢×™× ×ª ×”×˜×‘×œ×”
        const savedRows = JSON.parse(localStorage.getItem('tableRows_23'));
        const rows = document.querySelectorAll('#tableBody tr');
        
        if (savedRows && savedRows.length > 0) {
            rows.forEach((row, i) => {
                if (savedRows[i]) {
                    const data = savedRows[i];
                    
                    // ×”×–× ×ª ×”× ×ª×•× ×™× ×©× ×©××¨×•
                    const dateInput = row.querySelector('.row-date');
                    dateInput.value = data.date || "";
                    
                    row.querySelector('.time-out').value = data.timeOut || "08:00";
                    row.querySelector('.place-out').value = data.placeOut || "×ª\"×";
                    row.querySelector('.target-select').value = data.target || "";
                    row.querySelector('.place-in').value = data.placeIn || "×ª\"×";
                    row.querySelector('.km-input').value = data.km || "";
                    row.querySelector('.time-in').value = data.timeIn || "16:30";
                    row.querySelector('.cost-bus').value = data.costBus || "";
                    row.querySelector('.col-4').value = data.col4 || "X";
                    
                    const col8 = row.querySelector('.col-8');
                    col8.value = data.col8 || "X";
                    
                    row.querySelector('.cost-hotel').value = data.costHotel || "";

                    // --- ×”×ª×™×§×•×Ÿ: ×‘×“×™×§×” ××—×“×© ×× ×–×” ×™×•× ×¨××©×•×Ÿ ×‘×¢×ª ×”×˜×¢×™× ×” ---
                    if (dateInput.value) {
                        const parts = dateInput.value.split('-'); 
                        const date = new Date(parts[0], parts[1] - 1, parts[2]);
                        
                        if (date.getDay() === 0) { // ×× ×–×” ×™×•× ×¨××©×•×Ÿ
                            col8.value = "";       // × ×§×” ××ª ×¢××•×“×” 8
                        }
                    }
                    // --- ×¡×•×£ ×”×ª×™×§×•×Ÿ ---
                }
            });
        }
    }
    function resetForm() {
        if(confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ× ×§×•×ª ××ª ×›×œ ×”× ×ª×•× ×™× ×•×œ×”×ª×—×™×œ ×—×•×“×© ×—×“×©?")) {
            localStorage.clear();
            location.reload();
        }
    }

    function syncDatesWithMonth() {
        const month = document.getElementById('reportMonth').value;
        const year = document.getElementById('reportYear').value;
        const minDate = `${year}-${month}-01`;
        const lastDayObj = new Date(year, month, 0); 
        const lastDay = lastDayObj.getDate();
        const maxDate = `${year}-${month}-${lastDay}`;
        
        document.querySelectorAll('.row-date').forEach(input => { 
            input.min = minDate; input.max = maxDate; 
        });
        saveFormData();
    }

    function createRow(index) {
        let optionsHtml = '<option value="">×‘×—×¨ ×™×¢×“...</option>';
        destinations.forEach(d => optionsHtml += `<option value="${d.name}" data-km="${d.km}">${d.name}</option>`);
        return `<tr>
            <td><b>${index}</b></td>
            <td class="auto-width"><input type="date" class="row-date" onchange="handleDateChange(this)"></td>
            <td><input type="text" class="time-out" value="08:00"></td>
            <td><input type="text" class="place-out" value='×ª"×'></td>
            <td class="auto-width">
                <select class="target-select" onchange="const row=this.closest('tr'); const opt=this.options[this.selectedIndex]; if(this.value) row.querySelector('.km-input').value=opt.getAttribute('data-km'); saveFormData();">
                    ${optionsHtml}
                </select>
            </td>
            <td><input type="text" class="place-in" value='×ª"×'></td>
            <td><input type="text" class="km-input"></td>
            <td><input type="text" class="time-in" value="16:30"></td>
            <td><input type="number" class="cost-bus"></td>
            <td><input type="text" class="col-4" value="X" style="font-weight:bold;"></td>
            <td><input type="text" class="col-8" value="X" style="font-weight:bold;"></td>
            <td></td>
            <td><input type="number" class="cost-hotel"></td>
        </tr>`;
    }

    function saveAndPrint() {
        saveFormData(); 
        const lname = document.getElementById('lastName').value || "×¢×•×‘×“";
        const fname = document.getElementById('firstName').value || "";
        const dateInputs = Array.from(document.querySelectorAll('.row-date')).map(i => i.value).filter(v => v).sort();
        let dateSuffix = "";
        if (dateInputs.length > 0) {
            const first = dateInputs[0].split('-').reverse().join('-');
            const last = dateInputs[dateInputs.length - 1].split('-').reverse().join('-');
            dateSuffix = `_${first}_×¢×“_${last}`;
        }
        document.title = `${lname}_${fname}${dateSuffix}_×˜×•×¤×¡_×›×œ×›×œ×”`;
        window.print();
    }

    const tbody = document.getElementById('tableBody');
    // Generating 23 rows
    for(let i=1; i<=23; i++) tbody.innerHTML += createRow(i);
    
    window.onload = () => { 
        loadFormData(); 
        syncDatesWithMonth(); 
        setupSignature('workerSig');
        
        document.body.addEventListener('input', function(e) {
            if(e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
                saveFormData();
            }
        });
    };
</script>
</body>
</html>
